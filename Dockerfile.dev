# Development Image - Extends base with dev-specific tools
FROM ./Dockerfile.base

LABEL description="Ruby Rails development base image with dev tools"
LABEL version="dev-3.0"

# Switch back to root to install packages
USER root

# Install development-specific packages
RUN apk add --no-cache \
    # Additional build dependencies for dev
    g++ \
    cmake \
    autoconf \
    automake \
    libtool \
    curl-dev \
    # Enhanced image processing for dev
    imagemagick-dev \
    libjpeg-turbo-dev \
    libpng-dev \
    freetype-dev \
    libwebp-dev \
    # Additional databases for dev
    sqlite \
    sqlite-dev \
    # JavaScript package managers
    yarn \
    # System utilities for development
    wget \
    # Development editors and tools
    vim \
    nano \
    less \
    tree \
    # Additional compression tools
    bzip2 \
    xz \
    && rm -rf /var/cache/apk/*

# Configure development environment
ENV MALLOC_ARENA_MAX=2

# Pre-install development-specific gems
RUN gem install --no-document \
    redis \
    sidekiq \
    debug \
    rspec \
    rubocop

# Health check for development
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD curl -f http://localhost:3000/health || exit 1

# Switch back to non-root user
USER appuser

CMD ["/bin/bash"]